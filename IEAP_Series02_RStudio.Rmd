---
title: "Assignement : statistical tests"
author: "Hugo DUCHEMIN"
date: "30/09/2025"
output:
  html_document:
    df_print: paged
    code_folding: hide
    toc: false
    number_sections: false
---
# 2 Statistical tests: comparison of medians (or means?)

## 2.1 Make clear what is a statistical test, and when to use it.

>**Question 1 : What is a median? A mean?**
*"The median is the central value when all observations are sorted in order. If there is an odd number of observations then it is simply the middle value; if there is an even number of observations then it is the average of the middle" (Whitley & Ball, 2001). DOI: 10.1186/cc1455*

>**Question 2 : What is a variance? A standard deviation?**
*"The variance provides a quantitative measure of how closely the data set is spread around its center (Yang and al., 2018). DOI: 10.1177/2041669517747297"*

>**Question 3 : What is a normal distribution?**
*"A normal distribution, also called Gaussian distribution, has a symmetrical shape with the highest frequency at the center of the distribution and frequencies decreasing as values move away from the center" (Habibzadeh, 2024). DOI: 10.3346/jkms.2024.39.e35*

>**Question 4 : What is a statistical test?**
*"Statistical tests are mathematical tools for analyzing quantitative data generated in a research study" (Parab & Bhalerao, 2010). DOI : 10.4103/0974-7788.72494*

>**Question 5 :When to use a statistical test?**
*"In terms of selecting a statistical test, the most important question is “what is the main study hypothesis? If a scientific question is to be examined by comparing two or more groups, one can perform a statistical test"(Parab & Bhalerao, 2010). DOI : 10.4103/0974-7788.72494*

>**Question 6 : What is a parametric test? A non-parametric test?**
*"Parametric statistical procedures assume that the sample distribution is about the same shape (ie, normally distributed) and has the same parameters (ie, means and standard deviations) as the general population distribution.Nonparametric statistical procedures make no such assumptions about the shape or parameters of the population distribution"(Spine, 2018). DOI : 10.1177/2192568218782679*

>**Question 7 : What are the assumptions of parametric tests?**
*"The assumptions of parametric tests are: 1) normality , 2) Independance, 3) Homogeneity of variance, 4) Scale of measurement, 5) Absence of extreme outliers" (Moore and al.2019) DOI : 10.1186/s13040-019-0194-z*

>**Question 8 : What are the assumptions of non-parametric tests?**
*"The assumptions of non-parametric tests are : 1) Independance, 2) Ordinal continuous data, 3) Similar shapes of distributions, 4) Random sampling, 5) No strict assumption of normality or homogenity of variance"(Hopkins and al. 2018) DOI : 10.1177/2192568218782679*

>**Question 9 : What is a p-value?**
*"The P value means the probability, for a given statistical model that, when the null hypothesis is true, the statistical summary would be equal to or more extreme than the actual observed results"(Wasserstein & Lazar, 2016). DOI : 10.1080/00031305.2016.1154108*

>**Question 10 : What is the risk of error when using a statistical test?**
*"The risk of error when using a statistical test is the risk of concluding that a difference exists when in fact it does not (Type I error) or the risk of concluding that no difference exists when in fact it does (Type II error)"(Kim, 2015). DOI : 10.4097/kjae.2015.68.3.210*

>**Question 11 : What is the difference between a paired and an unpaired test?**
*"A paired test is a statistical test used when the observations in the two groups are dependent or related, such as repeated measurements on the same subjects. A non‑paired (independent) test is used when the observations in the two groups are independent, meaning the measurements in one group do not influence or correspond to the measurements in the other group" (Wag and al., 2022) DOI: 10.1111/rssb.12541*

## 2.2 Effect of treatment over time

### 2.2.1 The data
Download the file PrePost.csv
```{r load-data}
prepost <- read.csv("data/test_data/PrePost.csv",header=TRUE)
head(prepost)
summary(prepost)
```
|Variable | Description | Unit | Possible values | Expected change |
|---------|-------------|------|-----------------|-----------------|
|HR rest   | Hear Rate at rest fo the cardiac patients  | beats per minute (bpm) | 60-100 bpm | Decrease in HR |


*This table summarizes the variable present in the dataset PrePost.csv. The variable "HR rest" represents the heart rate at rest for cardiac patients, measured in beats per minute (bpm). Throw this rehabilitation training, we expect a decrease in resting heart rate, indicating improved cardiovascular fitness.*

### 2.2.2 The analysis

```{r test if normal distribution}
# We separate the two groups
rest.Pre  <- prepost$perf[prepost$time == "Before"]
rest.Post <- prepost$perf[prepost$time == "After"]

# Shapiro-Wilk normality test
shapiro.test(rest.Pre)
shapiro.test(rest.Post)
```

*The Shapiro-Wilk normality test results indicate that both groups have p-values more than 0.05, suggesting that the data follow a normal distribution. Therefore, we will use a parametric test to compare the two groups.*

```{r paired t-test}
# Paired t-test
t_test_result <- t.test(rest.Pre, rest.Post, paired = TRUE)
t_test_result
```

*The results of the paired t-test show a p-value less than 0.05, indicating a statistically significant difference between the heart rates before and after the rehabilitation training. This results suggests that the treatment has a significant effect on reducing resting heart rate in cardiac patients.*

```{r boxplot}
# Boxplot to visualize the effect of the treatment
prepost$time <- factor(prepost$time, levels = c("Before", "After"))
boxplot(perf ~ time, data = prepost, 
        main = "Effect of Rehabilitation Training on cardiac patients HR",
        xlab = "Time", ylab = "Resting Heart Rate (bpm)",
        col = c("lightblue", "lightgreen"))
```

*The boxplot illustrates the effect of rehabilitation training on the resting heart rate of cardiac patients. We can observe an increase in the median HR after the treatment compared to before the treatment.*

## Final result : 
*The statistical analysis, supported by the boxplot, indicates that the rehabilitation training has a significant effect on resting heart rate in cardiac patients. Assuming that the goal of the rehabilitation training is to lower patients’ heart rate, we could conclude that the program had an effect between the before and after phases. However, this effect was in the opposite direction than expected, as an increase in heart rate was observed after the training.*

## 2.3 Testing some stereotypes
Humans have stereotypes, some of them are probably true, some others are probably false (Cundiff and al., 2013 ; Blum, 2004) 
DOI 10.1007/s11218-013-9232-8
DOI 10.1080/05568640409485143

### 2.3.1 The data
```{r import data snore.txt}
snore <- read.table("data/test_data/snore.txt", header=TRUE)
head(snore)
summary(snore)
```
|Variable | Description | Unit | Values |
|---------|-------------|------|-----------------|
|Age   | Age of the patient  | years | 23-74 |
|Weight   | Weight of the patient  | kg | 42-120 |
|Height   | Height of the patient  | cm | 158-208|
|Alcohol  | Alcohol consumption  | liters | 0-15 |
|Sex   | Sex of the patient  | H/F | ' |
|Snore   | Snoring status  | Oui(O)/Non(N) | ' |
|Tobacco   | Smoking status  | Oui(O)/Non(N) | ' |


*This table describe the different variables of the data files in order to understand what we are going to analyse.* 

### 2.3.2 The analysis
 
>**Are snorers fatter ?**

```{r test normality - snorers}
# We separate the two groups
snore_weight  <- snore$weight[snore$snore == "O"]
non_snore_weight <- snore$weight[snore$snore == "N"]

# Shapiro-Wilk normality test
shapiro.test(snore_weight)
shapiro.test(non_snore_weight)
```

*The normality test indicate that the distribution of the two groups studied is not normal (p-value < 0.05). Therefore, we have to use a non-parametric test to compare the two groups, the Wilcoxon test.*
```{r statistical Wilcoxon test - snorers}
# Wilcoxon test
wilcox_test<- wilcox.test(snore_weight, non_snore_weight)
wilcox_test
```

*The results of the Wilcoxon test show a p-value less than 0.05, indicating no significant difference in weight between snorers and non-snorers. However, it can be interesting to visualise the data throw a boxplot in order to observe trend or outliers.* 
```{r boxplot snorers}
# Boxplot to visualize the weight of snorers and non-snorers
boxplot(weight ~ snore, data = snore, 
        main = "Are snorers fatter ?",
        xlab = "Snoring Status", ylab = "Weight (kg)",
        col = c("lightblue", "lightgreen"),
        names = c("Non-Snorers", "Snorers"))
```

*The boxplot illustrates the weight distribution of snorers and non-snorers. We can observe that the median weight of snorers is slightly higher than that of non-snorers but nothing really significant (like the statistical test demonstrate).*

>**Sentence result :**
Throw the Wilcoxon test and the boxplot, we can conclude that there is no significant difference in weight between snorers and non-snorers and that the stereotype "snorers are fatter" is not supported by the data.

>**Do snorers drink or smoke more ?**

```{r table contingency}
#  Contingency table Snore (Yes/No) × Tabac (Yes/No)
table_snore_tabac <- table(snore$snore, snore$tabac)
rownames(table_snore_tabac) <- c("Non-Snorers", "Snorers")
colnames(table_snore_tabac) <- c("Non-Smokers", "Smokers")
print(table_snore_tabac)

# Contingency table Snore (Yes/No) × Alcool (Low/Medium/High) 
snore$alcool_cat <- cut(snore$alcool,
                        breaks = c(-1,0, 5, 10, Inf),
                        labels = c("None","Low", "Medium", "High"))

table_snore_alcool <- table(snore$snore, snore$alcool_cat)
rownames(table_snore_alcool) <- c("Non-Snorers", "Snorers")
colnames(table_snore_alcool) <- c("None","Low", "Medium", "High")
print(table_snore_alcool)
```

*Although this contingency table is not a statistical test, it allows us to get an idea of what we are going to calculate*

```{r chi2 test - snorers X tabac}
# Chi-squared test for Snore × Tabac
chi2_tabac <- chisq.test(table_snore_tabac)
chi2_tabac
chi2_tabac$expected
```

*The results of the Chi-squared test for the association between snoring and smoking status show a p-value greater than 0.05, indicating no significant association between the two variables.* 

```{r normality distribution - snorers X alcool}
# test the normality of the distribution of alcohol consumption in snorers and non-snorers
shapiro.test(snore$alcool[snore$snore == "O"])
shapiro.test(snore$alcool[snore$snore == "N"])
```

*The result of the normality test show a p-value <0.05 meaning that the distribution is not normal. We will proceed to a Wilcoxon test.*

```{r wilcoxon test - snorers X alcool}
# Wilcoxon test for Snore × Alcool
wilcox_alcool <- wilcox.test(alcool ~ snore, data = snore)
wilcox_alcool
```
*The results of the Wilcoxon test show a significant difference between snorers and non-snorers in terms of alcohol consumption (p-value < 0.05). However, in order to know which group consume more, we have to compare the mean of two groups in alcohol consumption.*

```{r mean alcool consumption - snorers X alcool}
# Mean alcohol consumption for Snorers and Non-Snorers
mean_alcool_snorers <- mean(snore$alcool[snore$snore == "O"])
mean_alcool_non_snorers <- mean(snore$alcool[snore$snore == "N"])
mean_alcool_snorers
mean_alcool_non_snorers
```

*The mean alcohol consumption for snorers is 4.02 liters, while for non-snorers it is 2.36 liters. This indicates that snorers consume more alcohol on average than non-snorers.*

```{r barplot snorers X tabac and alcool}
# Barplot for Snore × Tabac
barplot(table_snore_tabac, beside = TRUE,
        main = "Snoring Status vs Smoking Status",
        xlab = "Smoking Status", ylab = "Count",
        col = c("lightblue", "lightgreen"),
        legend = rownames(table_snore_tabac))
# Barplot for Snore × Alcool
barplot(table_snore_alcool, beside = TRUE,
        main = "Snoring Status vs Alcohol Consumption",
        xlab = "Alcohol Consumption", ylab = "Count",
        col = c("lightblue", "lightgreen"),
        legend = rownames(table_snore_alcool))
#Barplot for Snore X Alcool mean
barplot(c(mean_alcool_non_snorers, mean_alcool_snorers),
        names.arg = c("Non-Snorers", "Snorers"),
        main = "Mean Alcohol Consumption by Snoring Status",
        xlab = "Snoring Status", ylab = "Mean Alcohol Consumption (liters)",
        col = c("lightblue", "lightgreen"))
```

*The different barplots illustrate the distribution of snoring status across different smoking statuses and alcohol consumption levels. The graphs supports the statistical results throw chi2 and Wilcoxon test.* 
>**Sentence result :**
Throw the Chi-squared test and the barplots, we can conclude that there is no significant association between snoring and smoking status. However, throw the Wilcoxon test, we found a significant difference in alcohol consumption between snorers ans non-snorers where snores drinks more.

>**Are men fatter ?**

```{r normality test sex X weight}
# We separate the two groups
men_weight <- snore$weight[snore$sex =="H"]
women_weight <- snore$weight[snore$sex =="F"]

# Shapiro-Wilk normality test
shapiro.test(men_weight)
shapiro.test(women_weight)
```

*The normality test indicate that the distribution of the two groups studied is not normal (p-value < 0.05). Therefore, we have to use a non-parametric test to compare the two groups, the Wilcoxon test like in the first stereotype analysis.*

```{r Wilcoxon test - sex X weight}
wilcox_test<- wilcox.test(men_weight, women_weight)
wilcox_test
```

*The Wilcoxon test reveal that there is no significant difference in weight between men and women (p-value > 0.05). However, it can be interesting to visualise the data throw a boxplot in order to observe trend or outliers.*

```{r boxplot sex X weight}
# Boxplot to visualize the weight according to sex 
boxplot(weight ~ sex, data = snore, 
        main = "Are men fatter ?",
        xlab = "Sex", ylab = "Weight (kg)",
        col = c("lightblue", "lightgreen"),
        names = c("Women", "Men"))

```

*The box plot show us no significant difference between weight according to sex. However, we can see that there is more variability in the weight among men.*
>**Sentence result :**
Throw the Wilcoxon tests and illustrated by the boxplot, we can conclude that the men are not fatter than the women is this data set. The answer to the question "are men fatter ?" is false in our data set. 

>**Do women smoke less ?**

```{r table of contingency sex X tabac}
#  Contingency table sex (H/F) × Tabac (Yes/No)
table_sex_tabac <- table(snore$sex, snore$tabac)
rownames(table_sex_tabac) <- c("Women", "Men")
colnames(table_sex_tabac) <- c("Non-Smokers", "Smokers")
print(table_sex_tabac)
```
```{r chi2 test for sex X tabac}
chi2_sex_tabac <- chisq.test(table_sex_tabac)
chi2_sex_tabac
chi2_sex_tabac$expected

```
```{r test z for sex X tabac}
# Test z for proportion
prop.test(table_sex_tabac)
result <- prop.test(table_sex_tabac)
```

*We wanted to test two different statistical test (Chi2 and z-test) in order to compare the results. Both of the test show us a significant difference (p<0.05) between sex for smoking where women smoke less than men. The samples estimate in the z-test quantify the difference: 60% of men smoke, whereas only 28% of women do. Let's illustrate this result with a barplot.*

```{r barplot for sex X tabac}
# Barplot for Sex × Tabac
barplot(table_sex_tabac, beside = TRUE,
        main = "Do women smoke less ?",
        xlab = "Smoking Status", ylab = "Count",
        col = c("lightgreen", "lightblue"), 
        names.arg = colnames(table_sex_tabac))

# Add legend
legend("topright", legend = rownames(table_sex_tabac),
       fill = c("lightgreen", "lightblue"))
```
>**Sentence result :**
Throw two statistical test, we can conclude that there is a significant difference between sex on smoking, where women smoke less than men in our data set. We can confirm that this stereotype is true in this data set.






